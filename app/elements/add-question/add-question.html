<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../question-level-dropdown/question-level-dropdown.html">

<dom-module id="add-question">
  <template>
    <style>
      :host {
        display: block;
      }

      paper-card {
        display: block;
      }

      .card-actions {
        text-align: right;
      }
    </style>

    <firebase-collection
      id="questionsCollection"
      location="https://id-questions.firebaseio.com/questions"
      data="{{questions}}"
    ></firebase-collection>

    <app-login user="{{user}}" hidden$="{{computeLoginHidden(user)}}"></app-login>

    <paper-card heading="Add Question" hidden$="{{computeFormHidden(user)}}">
      <form id="form" is="iron-form" method="post" action="/form/handler">
        <div class="card-content">
          <paper-input name="question" label="Question:" required></paper-input>
          <paper-textarea name="answer" label="Answer:" required></paper-textarea>
          <question-level-dropdown
            name="level" label="Level" required
          ></question-level-dropdown>

          <input name="user" type="hidden" value="[[user.uid]]">
        </div>
        <div class="card-actions">
          <paper-button on-tap="submitForm">Submit</paper-button>
        </div>
      </form>
    </paper-card>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'add-question',

      properties: {
        user: {
          type: Object,
          value: function () {
            return {};
          }
        }
      },

      listeners: {
        'iron-form-presubmit': '_handlePresubmit'
      },

      computeFormHidden: function (user) {
        return !(!!user && !!user.uid);
      },

      computeLoginHidden: function (user) {
        return !!user && !!user.uid;
      },

      submitForm: function () {
        this.$.form.submit();
      },

      _handlePresubmit: function (ev) {
        var form = this.$.form;

        ev.preventDefault();

        this.$.questionsCollection.add(form.serialize());
        form.reset();
      }
    });
  })();
  </script>
</dom-module>
